# HTTPS

## 抓包工具如何抓取https

​	抓包工具截获服务端的证书，并把自己的证书给客户端，客户端加密明文后，被工具解密成明文，然后再用服务端的证书加密发送给服务端。

## 有次连接失败问题

​	曾经解决过一个https无法建立连接的问题，通过抓包查到了问题所在。问题是客户端所支持的加密算法（XP），服务器都不支持，最终是在服务器增加了加密算法。

## 如何反抓包

​	证书锁定 SSL/TLS pinning，将服务器提供的SSL/TLS证书内置到移动端开发的APP客户端中，当客户端发起请求时，通过比对内置的证书和服务器端证书的内容，以确定这个连接的合法性。其中有证书锁定和公钥锁定。证书锁定的话会面临过期问题，公钥的话可以一直不变。

​	如何破解SSL pinning，安卓使用JustTrustMe这个Xposed模块，它所做的事情就是将各种已知的的HTTP请求库中用于校验证书的API都进行Hook，使无论是否是可信证书的情况，校验结果返回都为正常状态，从而实现绕过证书检查的效果。

​	安卓有UserCA，开发者可以选择只信任某些证书，而不是所有系统根下的。